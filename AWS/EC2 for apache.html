<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link rel="icon" href="https://s3.eu-west-2.amazonaws.com/maximilian-lever.com-assets/IMG/MJL.png" />
    <title>AWS - EC2 apache</title>
    <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/blog/" /><!-- Bootstrap core CSS -->
    <link href="https://dipvkpx7wt4f2.cloudfront.net/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" /><!-- Custom styles for this template -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Ballet&display=swap" rel="stylesheet"/>
    <link href="https://dipvkpx7wt4f2.cloudfront.net/assets/css/01aaa1aah.css" rel="stylesheet"/><!-- IDE -->
    <style>
      p{font-size: 0.8em;}
      @media (min-width:768px) {p{font-size: 1em;}}
    </style>
  </head>
  <body data-new-gr-c-s-check-loaded="14.997.0" data-gr-ext-installed="">
    <div class="container">
      <header class="blog-header py-3">
        <div class="row flex-nowrap justify-content-between align-items-center">
          <div class="col-4 pt-1"></div>
          <div class="col-4 text-center">
            <a class="blog-header-logo text-dark" href="#" style="font-family: 'Ballet', cursive;text-decoration: none;">
              <h1 style="font-weight: 600;">Maximilian Lever</h1>
            </a>
          </div>
          <div class="col-4 d-flex justify-content-end align-items-center"></div>
        </div>
      </header>
      <div class="nav-scroller py-1 mb-2">
        <nav class="nav d-flex justify-content-between">
          <a class="p-2 text-muted" href="../AWS/ActiveDirectory.html">AWS</a>
          <a class="p-2 text-muted" href="../BeaverBuilder/setup.html">Beaver Builder</a>
          <a class="p-2 text-muted" href="../CSS/bootstrap.html">CSS</a>
          <a class="p-2 text-muted" href="../G.I.M.P/transparent.html"   >G.I.M.P</a >
          <a class="p-2 text-muted" href="../MYSQL/tutorial.html">MYSQL</a>
          <a class="p-2 text-muted" href="../PHP/MVC.html">PHP</a>
          <a class="p-2 text-muted" href="../Python/machineLearning.html">Python</a>
        </nav>
      </div>
    </div>
    <main role="main" class="container">
      <div class="row">
        <div class="col-md-8 blog-main">
          <h3 class="pb-3 mb-4 font-italic border-bottom">EC2</h3>
          <div class="blog-post">
            <h2 class="blog-post-title">Set up EC2 for apache</h2>
            <p class="blog-post-meta">October 12, 2020 by <a href="https://www.linkedin.com/in/maximilian-lever-09214097/">Maximilian Lever</a></p>
            <p>The following procedures help you install an Apache web server with PHP and MySQL support on your Amazon Linux instance (sometimes called a LAMP web server or LAMP stack). 
              You can use this server to host a static website or deploy a dynamic PHP application that reads and writes information to a database.</p>
            <p>Important</p>
            <p>If you are trying to set up a LAMP web server on an Ubuntu or Red Hat Enterprise Linux instance, this tutorial will not work for you.</p>
            <p>Option: Complete this tutorial using automation</p>
            <p>To complete this tutorial using AWS Systems Manager Automation instead of the following tasks, run the AWSDocs-InstallALAMPServer-AL Automation document.</p>
            <b>Tasks</b>
            <ol>
            <li>Prepare the LAMP server</li>
            <li>Test your Lamp server</li>
            <li>Secure the database server</li>
            <li>(Optional) Install phpMyAdmin</li>
            </ol>
            <p>Troubleshooting</p>
            <p>Related topics</p>
            <hr />
            <p>Step 1: Prepare the LAMP server</p>
            <p>Prerequisites</p>
            <p>This tutorial assumes that you have already launched a new instance using the Amazon Linux AMI, with a public DNS name that is reachable from the internet. </p>
            <p>For more information, see Step 1: Launch an instance. You must also have configured your security group to allow SSH (port 22), HTTP (port 80), and HTTPS (port 443) connections. </p>
            <p>To install and start the LAMP web server with the Amazon Linux AMI</p>
            <p>Connect to your instance.</p>
            <p>To ensure that all of your software packages are up to date, perform a quick software update on your instance. This process may take a few minutes, 
              but it is important to make sure that you have the latest security updates and bug fixes.</p>
            <p>The -y option installs the updates without asking for confirmation. If you would like to examine the updates before installing, you can omit this option.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo yum update -y</code>
              </div>
            </p>
            <p>Now that your instance is current, you can install the Apache web server, MySQL, and PHP software packages.</p>
            <p>Use the yum install command to install multiple software packages and all related dependencies at the same time.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo yum install -y httpd24 php72 mysql57-server php72-mysqlnd</code>
              </div>
            </p>
            <b>Note</b>
            <p>If you receive the error No package package-name available, then your instance was not launched with the Amazon Linux AMI (perhaps you are using Amazon Linux 2 instead). 
              You can view your version of Amazon Linux with the following command.</p>
            <p>cat /etc/system-release
            <p>Start the Apache web server.</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ sudo service httpd start<br>
                  Starting httpd:                                            [  OK  ]
                </code>
              </div>
            </p>
            <p>Use the chkconfig command to configure the Apache web server to start at each system boot.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo chkconfig httpd on</code>
              </div>
            </p>
            <p>The chkconfig command does not provide any confirmation message when you successfully use it to enable a service.</p>
            <p>You can verify that httpd is on by running the following command:</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ chkconfig --list httpd<br>
                  httpd           0:off   1:off   2:on    3:on    4:on    5:on    6:off
                </code>
              </div>
            </p>
            <p>Here, httpd is on in runlevels 2, 3, 4, and 5 (which is what you want to see).</p>
            <p>Test your web server.</p>
            <p>In a web browser, type the public DNS address (or the public IP address) of your instance.</p>
            <p>If there is no content in /var/www/html, you should see the Apache test page.</p>
            <p>You can get the public DNS for your instance using the Amazon EC2 console (check the Public DNS column; if this column is hidden, choose Show/Hide Columns (the gear-shaped icon) and choose Public DNS).</p>
            <p>If you are unable to see the Apache test page, check that the security group you are using contains a rule to allow HTTP (port 80) traffic.</p>
            <b>Note</b>
            <p>This test page appears only when there is no content in /var/www/html. When you add content to the document root, your content appears at the public DNS address of your instance instead of this test page.</p>
            <p>Apache httpd serves files that are kept in a directory called the Apache document root. The Amazon Linux Apache document root is /var/www/html, which by default is owned by root.</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ ls -l /var/www<br>
                  total 16<br>
                  drwxr-xr-x 2 root root 4096 Jul 12 01:00 cgi-bin<br>
                  drwxr-xr-x 3 root root 4096 Aug  7 00:02 error<br>
                  drwxr-xr-x 2 root root 4096 Jan  6  2012 html<br>
                  drwxr-xr-x 3 root root 4096 Aug  7 00:02 icons<br>
                  drwxr-xr-x 2 root root 4096 Aug  7 21:17 noindex
                </code>
              </div>
            </p>
            <p>To allow the ec2-user account to manipulate files in this directory, you must modify the ownership and permissions of the directory. There are many ways to accomplish this task.</p>
            <p>In this tutorial, you add ec2-user to the apache group, to give the apache group ownership of the /var/www directory and assign write permissions to the group.</p>
            <p>To set file permissions</p>
            <p>Add your user (in this case, ec2-user) to the apache group.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo usermod -a -G apache ec2-user</code>
              </div>
            </p>
            <p>Log out and then log back in again to pick up the new group, and then verify your membership.</p>
            <p>Log out (use the exit command or close the terminal window):</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ exit</code>
              </div>
            </p>
            <p>To verify your membership in the apache group, reconnect to your instance, and then run the following command:</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ groups</code>
              </div>
            </p>
            <p>ec2-user wheel apache</p>
            <p>Change the group ownership of /var/www and its contents to the apache group.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo chown -R ec2-user:apache /var/www</code>
              </div>
            </p>
            <p>To add group write permissions and to set the group ID on future subdirectories, change the directory permissions of /var/www and its subdirectories.</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ sudo chmod 2775 /var/www<br>
                  [ec2-user ~]$ find /var/www -type d -exec sudo chmod 2775 {} \;
                </code>
              </div>
            </p>
            <p>To add group write permissions, recursively change the file permissions of /var/www and its subdirectories:</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ find /var/www -type f -exec sudo chmod 0664 {} \;</code>
              </div>
            </p>
            <p>Now, ec2-user (and any future members of the apache group) can add, delete, and edit files in the Apache document root, enabling you to add content, such as a static website or a PHP application.</p>
            <p>(Optional) Secure your web server</p>
            <p>A web server running the HTTP protocol provides no transport security for the data that it sends or receives. 
              When you connect to an HTTP server using a web browser, the URLs that you visit, the content of webpages that you receive, and the contents (including passwords) of any HTML forms that you submit are 
              all visible to eavesdroppers anywhere along the network pathway. The best practice for securing your web server is to install support for HTTPS (HTTP Secure), which protects your data with SSL/TLS encryption.</p>
            <p>For information about enabling HTTPS on your server, see Tutorial: Configure SSL/TLS on Amazon Linux.</p>
            <hr />
            <p>Step 2: Test your Lamp server</p>
            <p>If your server is installed and running, and your file permissions are set correctly, your ec2-user account should be able to create a PHP file in the /var/www/html directory that is available from the 
              internet.</p>
            <p>To test your LAMP web server</p>
            <p>Create a PHP file in the Apache document root.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ echo "<?php phpinfo(); ?>" > /var/www/html/phpinfo.php</code>
              </div>
            </p>
            <p>If you get a "Permission denied" error when trying to run this command, try logging out and logging back in again to pick up the proper group permissions that you configured in 
              Step 1: Prepare the LAMP server.</p>
            <p>In a web browser, type the URL of the file that you just created. This URL is the public DNS address of your instance followed by a forward slash and the file name. For example:</p>
            <p>http://my.public.dns.amazonaws.com/phpinfo.php</p>
            <p>You should see the PHP information page:</p>
            <p>If you do not see this page, verify that the /var/www/html/phpinfo.php file was created properly in the previous step. You can also verify that all of the required packages were installed with the 
              following command. The package versions in the second column do not need to match this example output.</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ sudo yum list installed httpd24 php72 mysql57-server php72-mysqlnd<br>
                  Loaded plugins: priorities, update-motd, upgrade-helper<br>
                  Installed Packages<br>
                  httpd24.x86_64                          2.4.25-1.68.amzn1                    @amzn-updates<br>
                  mysql56-server.x86_64                   5.6.35-1.23.amzn1                    @amzn-updates<br>
                  php70.x86_64                            7.0.14-1.20.amzn1                    @amzn-updates<br>
                  php70-mysqlnd.x86_64                    7.0.14-1.20.amzn1                    @amzn-updates
                </code>
              </div>
            </p>
            <p>If any of the required packages are not listed in your output, install them using the sudo yum install package command.</p>
            <p>Delete the phpinfo.php file. Although this can be useful information, it should not be broadcast to the internet for security reasons.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ rm /var/www/html/phpinfo.php</code>
              </div>
            </p>
            <hr />
            <p>Step 3: Secure the database server</p>
            <p>The default installation of the MySQL server has several features that are great for testing and development, but they should be disabled or removed for production servers. The mysql_secure_installation 
              command walks you through the process of setting a root password and removing the insecure features from your installation. Even if you are not planning on using the MySQL server, we recommend performing 
              this procedure.</p>
            <p>To secure the database server</p>
            <p>Start the MySQL server.</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ sudo service mysqld start<br>
                  Initializing MySQL database:<br>
                  ...<br>
                  PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !<br>
                  ...<br>
                  Starting mysqld:                                           [  OK  ]<br>
                  Run mysql_secure_installation.<br>
                  [ec2-user ~]$ sudo mysql_secure_installation
                </code>
              </div>
            </p>
            <p>When prompted, type a password for the root account.</p>
            <p>Type the current root password. By default, the root account does not have a password set. Press Enter.</p>
            <p>Type Y to set a password, and type a secure password twice. For more information about creating a secure password, see https://identitysafe.norton.com/password-generator/. Make sure to store this password 
              in a safe place.</p>
            <b>Note</b>
            <p>Setting a root password for MySQL is only the most basic measure for securing your database. When you build or install a database-driven application, you typically create a database service user for that 
              application and avoid using the root account for anything but database administration.</p>
            <p>Type Y to remove the anonymous user accounts.</p>
            <p>Type Y to disable the remote root login.</p>
            <p>Type Y to remove the test database.</p>
            <p>Type Y to reload the privilege tables and save your changes.</p>
            <p>(Optional) If you do not plan to use the MySQL server right away, stop it. You can restart it when you need it again.</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ sudo service mysqld stop<br>
                  Stopping mysqld:                                           [  OK  ]
                </code>
              </div>
            </p>
            <p>(Optional) If you want the MySQL server to start at every boot, type the following command.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo chkconfig mysqld on</code>
              </div>
            </p>
            <p>You should now have a fully functional LAMP web server. If you add content to the Apache document root at /var/www/html, you should be able to view that content at the public DNS address for your instance.</p>
            <hr />
            <p>Step 4: (Optional) Install phpMyAdmin</p>
            <p>To install phpMyAdmin</p>
            <p>phpMyAdmin is a web-based database management tool that you can use to view and edit the MySQL databases on your EC2 instance. Follow the steps below to install and configure phpMyAdmin on your Amazon Linux 
              instance.</p>
            <p>Important</p>
            <p>We do not recommend using phpMyAdmin to access a LAMP server unless you have enabled SSL/TLS in Apache; otherwise, your database administrator password and other data are transmitted insecurely across the 
              internet. For security recommendations from the developers, see Securing your phpMyAdmin installation.</p>
            <b>Note</b>
            <p>The Amazon Linux package management system does not currently support the automatic installation of phpMyAdmin in a PHP 7 environment. This tutorial describes how to install phpMyAdmin manually.</p>
            <p>Log in to your EC2 instance using SSH.</p>
            <p>Install the required dependencies.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo yum install php72-mbstring.x86_64 -y</code>
              </div>
            </p>
            <p>Restart Apache.</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ sudo service httpd restart<br>
                  Stopping httpd:                                            [  OK  ]<br>
                  Starting httpd:                                            [  OK  ]
                </code>
              </div>
            </p>
            <p>Navigate to the Apache document root at /var/www/html.</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ cd /var/www/html<br>
                  [ec2-user html]$ 
                </code>
              </div>
            </p>
            <p>Select a source package for the latest phpMyAdmin release from https://www.phpmyadmin.net/downloads.</p>
            <p>To download the file directly to your instance, copy the link and paste it into a wget command, as in this example:</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user html]$ wget https://www.phpmyadmin.net/downloads/phpMyAdmin-latest-all-languages.tar.gz</code>
              </div>
            </p>
            <p>Create a phpMyAdmin folder and extract the package into it using the following command.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user html]$ mkdir phpMyAdmin && tar -xvzf phpMyAdmin-latest-all-languages.tar.gz -C phpMyAdmin --strip-components 1</code>
              </div>
            </p>
            <p>Delete the phpMyAdmin-latest-all-languages.tar.gz tarball.</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user html]$ rm phpMyAdmin-latest-all-languages.tar.gz</code>
              </div>
            </p>
            <p>(Optional) If the MySQL server is not running, start it now.</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ sudo service mysqld start<br>
                  Starting mysqld:                                           [  OK  ]
                </code>
              </div>
            </p>
            <p>In a web browser, type the URL of your phpMyAdmin installation.</p>
            <p>This URL is the public DNS address (or the public IP address) of your instance followed by a forward slash and the name of your installation directory. For example:</p>
            <p>http://my.public.dns.amazonaws.com/phpMyAdmin</p>
            <p>You should see the phpMyAdmin login page:</p>
            <p>Log in to your phpMyAdmin installation with the root user name and the MySQL root password you created earlier.</p>
            <p>Your installation must still be configured before you put it into service.</p>
            <p>To configure phpMyAdmin, you can manually create a configuration file, use the setup console, or combine both approaches.</p>
            <p>For information about using phpMyAdmin, see the phpMyAdmin User Guide.</p>
            <p>Troubleshooting</p>
            <p>This section offers suggestions for resolving common problems you may encounter while setting up a new LAMP server.</p>
            <p>I can't connect to my server using a web browser.</p>
            <p>Perform the following checks to see if your Apache web server is running and accessible.</p>
            <p>Is the web server running?</p>
            <p>You can verify that httpd is on by running the following command:</p>
            <p>
              <div class="codeblock">
                <code>
                  [ec2-user ~]$ chkconfig --list httpd<br>
                  httpd           0:off   1:off   2:on    3:on    4:on    5:on    6:off
                </code>
              </div>
            </p>
            <p>Here, httpd is on in runlevels 2, 3, 4, and 5 (which is what you want to see).</p>
            <p>If the httpd process is not running, repeat the steps described in Step 1: Prepare the LAMP server.</p>
            <p>Is the firewall correctly configured?</p>
            <p>If you are unable to see the Apache test page, check that the security group you are using contains a rule to allow HTTP (port 80) traffic. For information about adding an HTTP rule to your security group, 
              see Adding rules to a security group.</p>
            <p>The application software I want to run on my server is incompatible with the installed PHP version or other software</p>
            <p>This tutorial recommends installing the most up-to-date versions of Apache HTTP Server, PHP, and MySQL. Before installing an additional LAMP application, check its requirements to confirm that it is 
              compatible with your installed environment. If the latest version of PHP is not supported, it is possible (and entirely safe) to downgrade to an earlier supported configuration. You can also install more 
              than one version of PHP in parallel, which solves certain compatibility problems with a minimum of effort. For information about configuring a preference among multiple installed PHP versions, 
              see Amazon Linux AMI 2016.09 Release Notes.</p>
            <p>How to downgrade</p>
            <p>The well-tested previous version of this tutorial called for the following core LAMP packages:</p>
            <p>httpd24</p>
            <p>php56</p>
            <p>mysql55-server</p>
            <p>Php56-mysqlnd</p>
            <p>If you have already installed the latest packages as recommended at the start of this tutorial, you must first uninstall these packages and other dependencies as follows:</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo yum remove -y httpd24 php72 mysql57-server php72-mysqlnd perl-DBD-MySQL57</code>
              </div>
            </p>
            <p>Next, install the replacement environment:</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo yum install -y  httpd24 php56 mysql55-server php56-mysqlnd</code>
              </div>
            </p>
            <p>If you decide later to upgrade to the recommended environment, you must first remove the customized packages and dependencies:</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ sudo yum remove -y  httpd24 php56 mysql55-server php56-mysqlnd perl-DBD-MySQL56</code>
              </div>
            </p>
            <p>Now you can install the latest packages, as described earlier.</p>
            <p>Fix for mysqld: unrecognized service:</p>
            <p>Use command  on server</p>
            <p>
              <div class="codeblock">
                <code>[ec2-user ~]$ systemctl start mysqld</code>
              </div>
            </p>
            <hr />
          </div><!-- /.blog-post -->
        </div><!-- /.blog-main -->
        <aside class="col-md-4 blog-sidebar">
          <div class="p-3">
            <h4 class="font-italic">Archives</h4>
            <ol class="list-unstyled mb-0" style="width: 130px;">
              <li><a class="p-2 text-muted" href="./ActiveDirectory.html">Active Directory</a></li>
              <li><a class="p-2 text-muted" href="./AWSCLI.html">AWSCLI</a></li>
              <li><a class="p-2 text-muted" href="./RDS.html">RDS</a></li>
              <li><a class="p-2 text-muted" href="./EC2.html">EC2</a></li>
              <li><a class="p-2 text-muted" href="#">EC2 for apache</a></li>
              <li>
                  <a class="p-2 text-muted" href="./Lightsail.html">Lightsail</a>
              </li>
              <li><a class="p-2 text-muted" href="./Workspace.html">Workspace</a></li>
              <li><a class="p-2 text-muted" href="./VPC.html">VPC</a></li>
              <li><a class="p-2 text-muted" href="./CloudFront.html">CloudFront</a></li>
              <li><a class="p-2 text-muted" href="./S3.html">S3</a></li>
              <li><a class="p-2 text-muted" href="./Route53.html">Route53</a></li>
            </ol>
          </div>
          <!-- <div class="p-3">
            <h4 class="font-italic">Elsewhere</h4>
            <ol class="list-unstyled">
              <li><a href="#">GitHub</a>.</li>
              <li><a href="#">Twitter</a>.</li>
              <li><a href="#">Facebook</a>.</li>
            </ol>
          </div> -->
        </aside><!-- /.blog-sidebar -->
      </div>
      <!-- /.row -->
    </main><!-- /.container -->
    <!-- Bootstrap core JavaScript ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://dipvkpx7wt4f2.cloudfront.net/assets/bootstrap/js/bootstrap.min.js"></script>
    <script> Holder.addTheme("thumb", { bg: "#55595c", fg: "#eceeef", text: "Thumbnail", }); </script>
    <svg xmlns="http://www.w3.org/2000/svg" width="200" height="250" viewBox="0 0 200 250" preserveAspectRatio="none" style=" display: none; visibility: hidden; position: absolute; top: -100%; left: -100%; " >
      <defs>
        <style type="text/css"></style>
      </defs>
      <text x="0" y="13" style=" font-weight: bold; font-size: 13pt; font-family: Arial, Helvetica, Open Sans, sans-serif; " >Thumbnail</text>
    </svg>
  </body>
</html>